{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}
{% block page_content %}

{% if project.title %}
    <title>{{ project.title|truncatechars:18 }}</title>
    <h2>{{ project.title }}</h2>
{% else %}
    <title>Project Details</title>
    <h2>Project Details</h2>
{% endif %}

<p><i>Posted by: {{ project.owner.username }} | <a href="{% url 'accounts:view_profile' project.owner.id %}"><small>View Profile</small></a></i></p>

{% if User.is_authenticated %}
    <form action="{% url 'projects:project_like' project.pk %}" method="POST">
        {% csrf_token %}
        {% if not liked %}
            <button type="submit" name="project_pk" value="{{ project.pk }}" class="btn btn-link btn-sm"><i class="fas fa-thumbs-up fa-sm" style="color: dodgerblue;"></i></button>
        {% else %}
            <button type="submit" name="project_pk" value="{{ project.pk }}" class="btn btn-link btn-sm"><i class="fas fa-thumbs-down fa-sm" style="color: Tomato;"></i></button>
        {% endif %}
            - {{ total_likes }} 
        {% if total_likes == 1 %} Like {% else %} Likes {% endif %}
    </form>
{% else %}
    <p><button type="" class="btn btn-link btn-sm"><i class="fas fa-thumbs-up fa-sm" style="color: black;"></i></button><small>- {{ total_likes }} 
    {% if total_likes == 1 %} Like {% else %} Likes {% endif %}</small></p>
    <p><a type="button" class="btn btn-primary" href="{% url 'login' %}">Log in</a>
         or <a type="button" class="btn btn-primary" href="{% url 'signup' %}?next={% url 'projects:all' %}">Sign up</a>
          to like your favorite projects and show some support!</p>
{% endif %}

{% if project.owner.profile.profile_pic %}
    <img src="{{ project.owner.profile.profile_pic.url }}" class="rounded-circle" width=75px height=75px>
{% else %}
    <img src="{% static 'personal_portfolio/images/filler_profile_image.jpg' %}" class="rounded-circle" width=75px height=75px>
{% endif %}

<hr>

<p>
{{ project.desc }}
</p>

<br>

{% if project.repo %}
    <a href="{{ project.repo }}">View Project Source Code</a>
{% else %}
    <p>No repository link.</p>
{% endif %}

<br>    

{% if project.image %}
    <img class="card-img-top" src="{{ project.image.url }}">
    <br>
{% else %}
    <p>No image uploaded.</p>
{% endif %}

{% if project.owner == User %}
    <br>
    <p>
        <a href="{% url 'projects:project_update' project.pk %}">Edit <i class="fa fa-pencil"></i></a> | 
        <a href="{% url 'projects:project_delete' project.pk %}?next={% url 'projects:all' %}">Delete <i class="fa fa-trash"></i></a>
    </p>
    <br>
{% endif %}
<hr>
<p>
    <a href="{% url 'projects:all' %}">Back to all projects</a>
    </p>
{% endblock %}